{% extends 'base.html.twig' %}

{% block title %}Products{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-100 py-10 px-4">
    <div class="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {% for product in products %}
            <div class="bg-white p-4 rounded-2xl shadow-lg border border-gray-200 flex flex-col">
                {% if product.image %}
                    <img src="{{ asset('uploads/product_images/' ~ product.image) }}"
                         alt="{{ product.name }}"
                         class="h-48 w-full object-cover rounded mb-4">
                {% else %}
                    <div class="h-48 w-full bg-gray-200 flex items-center justify-center rounded text-gray-400 text-xs italic mb-4">
                        No image
                    </div>
                {% endif %}

                <h2 class="text-lg font-bold text-gray-800">{{ product.name }}</h2>
                <p class="text-gray-600 mt-1">â‚¬{{ product.price|number_format(2) }}</p>

                <button onclick="addToCart({{ product.id }})"
                        class="mt-auto bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                    Add to Cart
                </button>
            </div>
        {% else %}
            <p class="text-gray-500 col-span-full">No products found.</p>
        {% endfor %}
    </div>
</div>

<script>
function addToCart(id) {
    fetch('/cart/add/' + id, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            const countEl = document.getElementById('cart-count');
            if (countEl) {
                countEl.innerText = data.count;
            }
        }
    });
}
</script>
{% endblock %}
